import core.io.console;
import core.crt.cstdlib;
import core.crt.cstring;

use console;

struct String {
	c8* data;
	u64 capacity;
	u64 size;


	@implicit
	def this(str8 str) {
		this.size = this.capacity = str.size;
		this.data = c8*(cstdlib.malloc(this.size));
		cstring.strncpy(this.data, str.data, str.size);
	}
	
	def public append(str8 str) {
		u64 newSize = this.size + str.size;
		if (newSize > this.capacity) {
			this.data = c8*(cstdlib.realloc(u8*(this.data), newSize));
			this.capacity = newSize;
		}
		
		cstring.strncat(this.data, str.data, str.size);
	}
	
	public static str8 typeName = "String";
}

struct Printer {
	def public static out(i32 val) {
		print("Printer: ");
		println(val);
	}
}

def main() i32 {
	String str = "Hello ";
	str.append("world from ");
	str.append(String.typeName);
	
	console.println(str.data);
	
	Printer.out(10);
	
	cstdlib.system("pause");
	return 0;
}